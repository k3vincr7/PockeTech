<!DOCTYPE html><html><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Pressure Switch Helper</title><link rel="stylesheet" href="../styles.css">
<script>
const n=v=>{if(v==null)return null;v=(''+v).replace(/,/g,'').trim();if(!v)return null;const x=parseFloat(v);return isNaN(x)?null:x;}
const pct=(val,l,u)=>(val-l)/(u-l)*100, fromPct=(p,l,u)=>l+(p/100)*(u-l);
const out=(id,s)=>document.getElementById(id).textContent=s;

function calcReset(){const dir=dirSel.value,l=n(ps_lrv.value),u=n(ps_urv.value),trip=n(ps_trip.value),db=n(ps_deadband.value);
  if([l,u,trip,db].some(v=>v==null)){out('ps_out1','Enter LRV, URV, Trip, Deadband.');return;}
  const reset = dir==='rising'?(trip-db):(trip+db);
  out('ps_out1',`Reset ≈ ${reset.toFixed(3)} ${ps_unit.value} • Trip=${pct(trip,l,u).toFixed(1)}% • Reset=${pct(reset,l,u).toFixed(1)}%`);
}
function calcDeadband(){const dir=dirSel.value,l=n(ps_lrv.value),u=n(ps_urv.value),trip=n(ps_trip2.value),reset=n(ps_reset2.value);
  if([l,u,trip,reset].some(v=>v==null)){out('ps_out2','Enter LRV, URV, Trip, Reset.');return;}
  const db = dir==='rising'?(trip-reset):(reset-trip);
  out('ps_out2',`Deadband ≈ ${db.toFixed(3)} ${ps_unit.value} • ${(db/(u-l)*100).toFixed(1)}% span`);
}
function calcFromPct(){const dir=dirSel.value,l=n(ps_lrv.value),u=n(ps_urv.value),pT=n(ps_pctTrip.value),pR=n(ps_pctReset.value);
  if([l,u,pT,pR].some(v=>v==null)){out('ps_out3','Enter LRV, URV, %Trip, %Reset.');return;}
  const trip=fromPct(pT,l,u),reset=fromPct(pR,l,u),db=dir==='rising'?(trip-reset):(reset-trip);
  out('ps_out3',`Trip ≈ ${trip.toFixed(3)} ${ps_unit.value} • Reset ≈ ${reset.toFixed(3)} ${ps_unit.value} • DB=${db.toFixed(3)} ${ps_unit.value}`);
}
</script>
</head><body>
<div class="wrap" id="switchHelper">
  <h1>Pressure Switch Helper</h1>

  <section class="tool">
    <div class="row">
      <div><label>Units</label><select id="ps_unit"><option selected>psi</option><option>inH2O</option><option>kPa</option></select></div>
      <div><label>Direction</label><select id="dirSel"><option value="rising" selected>Rising</option><option value="falling">Falling</option></select></div>
    </div>
    <div class="row">
      <div><label>LRV</label><input id="ps_lrv" inputmode="decimal"></div>
      <div><label>URV</label><input id="ps_urv" inputmode="decimal"></div>
    </div>
    <div class="row" style="margin-top:8px"><button onclick="clearTool('switchHelper')">Reset</button></div>
  </section>

  <section class="tool">
    <h3>Mode 1 — Trip + Deadband ⇒ Reset</h3>
    <div class="row">
      <div><label>Trip</label><input id="ps_trip" inputmode="decimal"></div>
      <div><label>Deadband</label><input id="ps_deadband" inputmode="decimal"></div>
    </div>
    <div class="row" style="margin-top:8px">
      <button onclick="calcReset()">Calculate Reset</button>
      <button onclick="clearTool('switchHelper')">Reset</button>
    </div>
    <pre id="ps_out1" class="result"></pre>
  </section>

  <section class="tool">
    <h3>Mode 2 — Trip + Reset ⇒ Deadband</h3>
    <div class="row">
      <div><label>Trip</label><input id="ps_trip2" inputmode="decimal"></div>
      <div><label>Reset</label><input id="ps_reset2" inputmode="decimal"></div>
    </div>
    <div class="row" style="margin-top:8px">
      <button onclick="calcDeadband()">Calculate Deadband</button>
      <button onclick="clearTool('switchHelper')">Reset</button>
    </div>
    <pre id="ps_out2" class="result"></pre>
  </section>

  <section class="tool">
    <h3>Mode 3 — % of Span ⇒ Setpoints</h3>
    <div class="row">
      <div><label>% Trip</label><input id="ps_pctTrip" inputmode="decimal"></div>
      <div><label>% Reset</label><input id="ps_pctReset" inputmode="decimal"></div>
    </div>
    <div class="row" style="margin-top:8px">
      <button onclick="calcFromPct()">Calculate</button>
      <button onclick="clearTool('switchHelper')">Reset</button>
    </div>
    <pre id="ps_out3" class="result"></pre>
  </section>
</div>
<script src="../script.js"></script>
</body></html>
