<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PockeTech — Field Tools (Simple)</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: #f5f5f5; color: #333; }
    header { background: #222; color: #fff; padding: 1em; text-align: center; }
    nav { display: flex; justify-content: center; background: #444; }
    nav button { background: #444; color: #fff; border: none; padding: 1em; cursor: pointer; }
    nav button:hover { background: #666; }
    main { padding: 1em; }
    section { display: none; }
    section.active { display: block; }
    input, button, textarea, select { margin: .3em 0; padding: .5em; }
    table { border-collapse: collapse; margin-top: 1em; width: 100%; }
    table, th, td { border: 1px solid #aaa; }
    th, td { padding: .5em; text-align: left; }
    .muted { font-size: 0.9em; color: #777; }
  </style>
</head>
<body>
  <header>
    <h1>PockeTech — Field Tools (Simple)</h1>
  </header>

  <nav>
    <button data-target="percent">Percent Steps</button>
    <button data-target="signal">Signal Helper</button>
    <button data-target="loop">Loop Check Log</button>
    <button data-target="legacy">Legacy Tools</button>
  </nav>

  <main>
    <!-- Percent Steps -->
    <section id="percent" class="active">
      <h2>Percent Steps</h2>
      <label>LRV: <input type="number" id="lrv"></label><br>
      <label>URV: <input type="number" id="urv"></label><br>
      <button onclick="calcPercent()">Calculate</button>
      <table id="percentTable"></table>
    </section>

    <!-- Signal Helper -->
    <section id="signal">
      <h2>Signal Helper</h2>
      <label>mA: <input type="number" id="ma" step="0.01"></label>
      <button onclick="maToPercent()">mA → %</button><br>
      <label>%: <input type="number" id="percentInput" step="0.1"></label>
      <button onclick="percentToMa()">% → mA</button>
      <p id="signalResult"></p>
    </section>

    <!-- Loop Check Log -->
    <section id="loop">
      <h2>Loop Check Log</h2>
      <form id="loopForm">
        <input placeholder="Tag" id="tag" required>
        <input placeholder="Service" id="service">
        <input placeholder="Range (LRV)" id="rangeLrv" type="number">
        <input placeholder="Range (URV)" id="rangeUrv" type="number">
        <input placeholder="Type" id="type">
        <input placeholder="As-Found" id="asFound">
        <input placeholder="As-Left" id="asLeft">
        <input placeholder="Technician" id="tech">
        <input placeholder="Date" id="date" type="date">
        <input placeholder="Notes" id="notes">
        <select id="status">
          <option value="Pass">Pass</option>
          <option value="Fail">Fail</option>
        </select>
        <button type="submit">Add</button>
      </form>
      <table id="loopTable">
        <thead>
          <tr>
            <th>Tag</th><th>Service</th><th>Range</th><th>Type</th>
            <th>As-Found</th><th>As-Left</th><th>Tech</th><th>Date</th>
            <th>Notes</th><th>Status</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
      <button onclick="downloadLoopCSV()">Download CSV</button>
    </section>

    <!-- Legacy Tools -->
    <section id="legacy">
      <h2>Legacy Tools</h2>
      <ul>
        <li><a href="tools/four20.html" target="_blank">4–20 mA Helper</a></li>
        <li><a href="tools/pressureA.html" target="_blank">Pressure A</a></li>
        <li><a href="tools/pressureC.html" target="_blank">Pressure: Gauge ↔ Absolute</a></li>
        <li><a href="tools/pressureSwitch.html" target="_blank">Pressure Switch</a></li>
        <li><a href="tools/pressureVac.html" target="_blank">Vacuum / Pressure</a></li>
      </ul>
      <p class="muted">These open the older standalone tools in new tabs.</p>
    </section>
  </main>

  <script>
    // Navigation
    document.querySelectorAll("nav button").forEach(btn => {
      btn.addEventListener("click", () => {
        document.querySelectorAll("main section").forEach(sec => sec.classList.remove("active"));
        document.getElementById(btn.dataset.target).classList.add("active");
      });
    });

    // Percent Steps
    function calcPercent() {
      let lrv = parseFloat(document.getElementById("lrv").value);
      let urv = parseFloat(document.getElementById("urv").value);
      if (isNaN(lrv) || isNaN(urv)) return;
      let steps = [0, 25, 50, 75, 100];
      let table = "<tr><th>%</th><th>Value</th></tr>";
      steps.forEach(p => {
        let val = lrv + (urv - lrv) * (p / 100);
        table += `<tr><td>${p}%</td><td>${val.toFixed(2)}</td></tr>`;
      });
      document.getElementById("percentTable").innerHTML = table;
    }

    // Signal Helper
    function maToPercent() {
      let ma = parseFloat(document.getElementById("ma").value);
      if (isNaN(ma)) return;
      let percent = ((ma - 4) / 16) * 100;
      document.getElementById("signalResult").innerText = `${ma} mA = ${percent.toFixed(1)}%`;
    }
    function percentToMa() {
      let p = parseFloat(document.getElementById("percentInput").value);
      if (isNaN(p)) return;
      let ma = 4 + (16 * (p / 100));
      document.getElementById("signalResult").innerText = `${p.toFixed(1)}% = ${ma.toFixed(2)} mA`;
    }

    // Loop Check Log
    let loopData = JSON.parse(localStorage.getItem("pocketech.looplog.v1") || "[]");
    const loopForm = document.getElementById("loopForm");
    const loopTableBody = document.querySelector("#loopTable tbody");

    function renderLoopTable() {
      loopTableBody.innerHTML = "";
      loopData.forEach(row => {
        let tr = document.createElement("tr");
        tr.innerHTML = `<td>${row.tag}</td><td>${row.service}</td><td>${row.range}</td>
          <td>${row.type}</td><td>${row.asFound}</td><td>${row.asLeft}</td>
          <td>${row.tech}</td><td>${row.date}</td><td>${row.notes}</td><td>${row.status}</td>`;
        loopTableBody.appendChild(tr);
      });
    }

    loopForm.addEventListener("submit", e => {
      e.preventDefault();
      let row = {
        tag: document.getElementById("tag").value,
        service: document.getElementById("service").value,
        range: document.getElementById("rangeLrv").value + " - " + document.getElementById("rangeUrv").value,
        type: document.getElementById("type").value,
        asFound: document.getElementById("asFound").value,
        asLeft: document.getElementById("asLeft").value,
        tech: document.getElementById("tech").value,
        date: document.getElementById("date").value,
        notes: document.getElementById("notes").value,
        status: document.getElementById("status").value
      };
      loopData.push(row);
      localStorage.setItem("pocketech.looplog.v1", JSON.stringify(loopData));
      renderLoopTable();
      loopForm.reset();
    });

    function downloadLoopCSV() {
      let csv = "Tag,Service,Range,Type,As-Found,As-Left,Tech,Date,Notes,Status\n";
      loopData.forEach(r => {
        csv += `${r.tag},${r.service},${r.range},${r.type},${r.asFound},${r.asLeft},${r.tech},${r.date},${r.notes},${r.status}\n`;
      });
      let blob = new Blob([csv], { type: "text/csv" });
      let url = URL.createObjectURL(blob);
      let a = document.createElement("a");
      a.href = url;
      a.download = "loop_check_log.csv";
      a.click();
      URL.revokeObjectURL(url);
    }

    renderLoopTable();
  </script>
</body>
</html>
